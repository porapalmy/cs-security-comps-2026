import yara
import os
import sys

RULES_DIR = "../rules"

def load_rules():
    rule_files = {}
    for f in os.listdir(RULES_DIR):
        if f.endswith(".yar"):
            rule_files[f] = os.path.join(RULES_DIR, f)
    return yara.compile(filepaths=rule_files)

def scan_directory(path):
    rules = load_rules()
    for root, _, files in os.walk(path):
        for file in files:
            if file.endswith(".html"):
                full_path = os.path.join(root, file)
                matches = rules.match(full_path)
                if matches:
                    print(f"[!] MALICIOUS: {full_path}")
                    for m in matches:
                        print(f"    - {m.rule}")
                else:
                    print(f"[+] CLEAN: {full_path}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python scan_html.py <directory>")
        sys.exit(1)
    scan_directory(sys.argv[1])
